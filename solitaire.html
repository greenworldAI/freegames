<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Free Solitaire – Zentroll</title>
  <style>
    /* Container: min 300px, fluid up to 90vw, max 600px */
    #sol-container {
      width: clamp(300px, 90vw, 600px);
      margin: 20px auto;
      font-family: sans-serif;
    }
    #sol-top {
      display: flex;
      gap: 8px;
    }
    #sol-tableau {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    /* show empty slots clearly */
    .slot, .pile {
      flex: 1;
      position: relative;
      aspect-ratio: 5/7;
      background: #1a2a3a;
      border: 2px dashed #555;
      border-radius: 4px;
      overflow: hidden;
    }
    .card {
      position: absolute;
      left: 0;
      width: 100%;
      aspect-ratio: 5/7;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      cursor: pointer;
    }
    /* striped back pattern */
    .card.back {
      background: #eee;
      background-image:
        repeating-linear-gradient(
          45deg,
          #ccc, #ccc 2px,
          #eee 2px, #eee 4px
        );
      border: 1px solid #aaa;
    }
    .card.face {
      background: #fff;
      border: 1px solid #444;
    }
  </style>
</head>
<body style="background:#0a1f3a; color:#eee;">

  <div id="sol-container">
    <div id="sol-top">
      <div id="stock" class="slot"></div>
      <div id="waste" class="slot"></div>
      <div class="slot foundation" data-suit="♠"></div>
      <div class="slot foundation" data-suit="♥"></div>
      <div class="slot foundation" data-suit="♦"></div>
      <div class="slot foundation" data-suit="♣"></div>
    </div>
    <div id="sol-tableau">
      <div class="pile" data-index="0"></div>
      <div class="pile" data-index="1"></div>
      <div class="pile" data-index="2"></div>
      <div class="pile" data-index="3"></div>
      <div class="pile" data-index="4"></div>
      <div class="pile" data-index="5"></div>
      <div class="pile" data-index="6"></div>
    </div>
  </div>

  <script>
  (()=>{
    const suits = ['♠','♥','♦','♣'],
          ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'],
          order = 'A23456789TJQK';

    let stock = [], waste = [],
        foundations = {'♠':[],'♥':[],'♦':[],'♣':[]},
        tableau = [[],[],[],[],[],[],[]],
        selected = null;

    const stockEl       = document.getElementById('stock'),
          wasteEl       = document.getElementById('waste'),
          foundationEls = document.querySelectorAll('.foundation'),
          pileEls       = document.querySelectorAll('.pile');

    function createDeck(){
      const d=[];
      for(let s of suits) for(let r of ranks)
        d.push({ suit:s, rank:r, color:(s==='♥'||s==='♦')?'red':'black', faceUp:false });
      return d;
    }

    function shuffle(a){
      for(let i=a.length-1;i>0;--i){
        let j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
    }

    function handleStock(){
      if(stock.length){
        let c=stock.pop(); c.faceUp=true; waste.push(c);
      } else {
        while(waste.length){
          let c=waste.pop(); c.faceUp=false; stock.push(c);
        }
      }
      selected=null; render();
    }

    function init(){
      stock=[]; waste=[];
      foundations={'♠':[],'♥':[],'♦':[],'♣':[]};
      tableau=[[],[],[],[],[],[],[]];
      selected=null;
      let deck=createDeck();
      shuffle(deck);
      let idx=0;
      for(let i=0;i<7;i++){
        for(let j=0;j<=i;j++){
          let card=deck[idx++]; card.faceUp=(j===i);
          tableau[i].push(card);
        }
      }
      while(idx<deck.length){
        let card=deck[idx++]; card.faceUp=false; stock.push(card);
      }
      render();
    }

    function render(){
      // clear UI
      stockEl.innerHTML=''; wasteEl.innerHTML='';
      document.querySelectorAll('.foundation, .pile')
              .forEach(el=>el.innerHTML='');

      // STOCK
      if(stock.length){
        const b=document.createElement('div');
        b.className='card back'; b.style.top='0'; b.style.zIndex=0;
        b.addEventListener('click',handleStock);
        stockEl.appendChild(b);
      }
      stockEl.onclick=handleStock;

      // WASTE
      if(waste.length){
        const top=waste[waste.length-1];
        const c=document.createElement('div');
        c.className='card face'; c.textContent=top.rank+top.suit;
        c.style.top='0'; c.style.zIndex=0;
        c.style.color=top.color==='red'? '#d00':'#000';
        wasteEl.appendChild(c);
      }
      wasteEl.onclick=()=>{
        if(waste.length){ selected={type:'waste'}; highlight(); }
      };

      // FOUNDATIONS
      foundationEls.forEach(el=>{
        const suit=el.dataset.suit, pile=foundations[suit]||[];
        if(pile.length){
          const top=pile[pile.length-1],
                c=document.createElement('div');
          c.className='card face';
          c.textContent=top.rank+top.suit;
          c.style.top='0'; c.style.zIndex=0;
          c.style.color=top.color==='red'? '#d00':'#000';
          el.appendChild(c);
        }
        el.onclick=()=>{
          if(!selected) return;
          const dest=foundations[suit]||[];
          let card = selected.type==='waste'
                     ? waste[waste.length-1]
                     : tableau[selected.pi][selected.ci];
          if(card&&card.suit===suit&&order.indexOf(card.rank)===dest.length){
            dest.push(card);
            if(selected.type==='waste') waste.pop();
            else tableau[selected.pi].pop();
          }
          selected=null; render();
        };
      });

      // TABLEAU with 35% overlap
      pileEls.forEach(el=>{
        const idx=parseInt(el.dataset.index,10),
              pileArr=tableau[idx]||[],
              h=el.clientHeight,
              overlap=h*0.35,        // increased from 0.2 to 0.35
              fs=h*0.3+'px';
        pileArr.forEach((card,ci)=>{
          const c=document.createElement('div');
          c.className='card '+(card.faceUp?'face':'back');
          c.style.top=(ci*overlap)+'px';
          c.style.zIndex=ci;
          if(card.faceUp){
            c.textContent=card.rank+card.suit;
            c.style.color=card.color==='red'? '#d00':'#000';
            c.style.fontSize=fs;
          }
          c.dataset.pile='tableau';
          c.dataset.pi=idx;
          c.dataset.ci=ci;
          el.appendChild(c);
        });

        el.onclick=e=>{
          const t=e.target;
          if(t.classList.contains('card')&&t.classList.contains('face')){
            const pi2=+t.dataset.pi, ci2=+t.dataset.ci;
            if(ci2===tableau[pi2].length-1){
              selected={type:'tableau',pi:pi2,ci:ci2};
              highlight();
            }
          } else if(selected){
            const dest=tableau[idx]||[];
            let card = selected.type==='waste'
                       ? waste[waste.length-1]
                       : tableau[selected.pi][selected.ci];
            const top=dest[dest.length-1],
                  ciCard=order.indexOf(card.rank),
                  ciTop=top?order.indexOf(top.rank):-1;
            if((!top&&card.rank==='K')||
               (top&&ciTop===ciCard+1&&top.color!==card.color)){
              dest.push(card);
              if(selected.type==='waste') waste.pop();
              else tableau[selected.pi].pop();
            }
            selected=null; render();
          }
        };
      });
    }

    function highlight(){
      document.querySelectorAll('.card').forEach(c=>c.style.outline='');
      if(!selected) return;
      let selEl;
      if(selected.type==='waste'){
        selEl=wasteEl.querySelector('.card.face');
      } else {
        selEl=document.querySelector(
          `.pile[data-index="${selected.pi}"] .card[data-ci="${selected.ci}"]`
        );
      }
      if(selEl) selEl.style.outline='3px solid yellow';
    }

    init();
  })();
  </script>
</body>
</html>
